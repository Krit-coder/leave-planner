<div class="planner-container">
  <!-- HEADER -->

  <!-- TOP BAR -->
  <div class="planner-top-bar">
    <!-- LEFT: Month & Year -->
    <div class="month-controls">
      <button class="nav-btn" (click)="changeMonth(-1)">‹</button>

      <select
        class="month-select"
        [(ngModel)]="currentMonth"
        (change)="onMonthYearChange()"
      >
        <option *ngFor="let m of months; let i = index" [value]="i">
          {{ m }}
        </option>
      </select>

      <select
        class="year-select"
        [(ngModel)]="currentYear"
        (change)="onMonthYearChange()"
      >
        <option *ngFor="let y of years" [value]="y">
          {{ y }}
        </option>
      </select>

      <button class="nav-btn" (click)="changeMonth(1)">›</button>
    </div>

    <!-- RIGHT: Filters -->
    <div class="filters-section">
      <!-- Mobile-only toggle -->
      <div class="filter-toggle" (click)="showFilters = !showFilters">
        Filters ▾
      </div>

      <!-- Filters (ALWAYS visible on PC) -->
      <div class="filters-bar" [class.mobile-hidden]="!showFilters">
        <div class="filter-group">
          <label>Role</label>
          <select [(ngModel)]="selectedRole" (change)="applyFilters()">
            <option *ngFor="let r of roles" [value]="r">{{ r }}</option>
          </select>
        </div>

        <div class="filter-group">
          <label>Location</label>
          <select [(ngModel)]="selectedLocation" (change)="applyFilters()">
            <option *ngFor="let l of locations" [value]="l">{{ l }}</option>
          </select>
        </div>

        <div class="filter-group">
          <label>Sub-team</label>
          <select [(ngModel)]="selectedModule" (change)="applyFilters()">
            <option *ngFor="let m of modules" [value]="m">{{ m }}</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <!-- CALENDAR -->
  <div class="calendar-scroll">
    <table class="planner-table">
      <thead>
        <tr>
          <th class="name-col">Name</th>

          <!-- Improved date header -->
          <th
            *ngFor="let d of daysInMonth"
            [class.weekend]="isWeekend(d)"
            [class.holiday]="isHoliday(d)"
          >
            <div class="date-header">
              <div class="day">{{ getDayName(d) }}</div>
              <div class="date">{{ d }}</div>
            </div>
          </th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let u of filteredUsers">
          <!-- Sticky name column -->
          <td class="name-col">
            {{ u.name }}
          </td>

          <!-- Calendar cells -->
          <td
            *ngFor="let d of daysInMonth"
            class="day-cell"
            [class.weekend]="isWeekend(d)"
            [class.holiday]="isHoliday(d)"
            [class.disabled]="isDisabledDay(d)"
            (click)="!isDisabledDay(d) && toggleLeave(+u.id, d)"
          >
            <!-- Planned Leave -->
            <div
              class="leave-chip planned"
              *ngIf="leavesMap.get(u.id + '_' + getDate(d)) === 'P'"
            >
              Planned
            </div>

            <!-- Unplanned Leave -->
            <div
              class="leave-chip unplanned"
              *ngIf="leavesMap.get(u.id + '_' + getDate(d)) === 'U'"
            >
              Unplanned
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
